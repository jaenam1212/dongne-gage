{
    "sourceFile": "app/[shop-slug]/reserve/[product-id]/page.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1770982677430,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1770983888161,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -133,9 +133,9 @@\n               가게로 돌아가기\n             </Link>\n           </div>\n         ) : (\n-          <ReservationForm product={product} shopSlug={slug} />\n+          <ReservationForm product={product} shopSlug={slug} shopName={shop.name} />\n         )}\n       </main>\n     </div>\n   )\n"
                }
            ],
            "date": 1770982677430,
            "name": "Commit-0",
            "content": "import type { Metadata } from 'next'\nimport { notFound } from 'next/navigation'\nimport Link from 'next/link'\nimport { createClient } from '@/lib/supabase/server'\nimport { ReservationForm } from '@/components/customer/reservation-form'\nimport { ArrowLeft, Clock } from 'lucide-react'\nimport { formatKoreanWon } from '@/lib/utils'\n\ninterface Props {\n  params: Promise<{ 'shop-slug': string; 'product-id': string }>\n}\n\nasync function getProductWithShop(slug: string, productId: string) {\n  const supabase = await createClient()\n\n  const { data: shop } = await supabase\n    .from('shops')\n    .select('id, slug, name, description, logo_url')\n    .eq('slug', slug)\n    .eq('is_active', true)\n    .single()\n\n  if (!shop) return null\n\n  const { data: product } = await supabase\n    .from('products')\n    .select('id, title, description, price, image_url, max_quantity, max_quantity_per_customer, reserved_count, deadline, is_active')\n    .eq('id', productId)\n    .eq('shop_id', shop.id)\n    .eq('is_active', true)\n    .single()\n\n  if (!product) return null\n\n  return { shop, product }\n}\n\nexport async function generateMetadata({ params }: Props): Promise<Metadata> {\n  const { 'shop-slug': slug, 'product-id': productId } = await params\n  const data = await getProductWithShop(slug, productId)\n\n  if (!data) {\n    return { title: '페이지를 찾을 수 없습니다' }\n  }\n\n  const { shop, product } = data\n  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || 'https://dongnegage.com'\n\n  return {\n    title: `${product.title} - ${shop.name}`,\n    description: product.description || `${shop.name}에서 ${product.title} 예약하기`,\n    openGraph: {\n      title: `${product.title} - ${shop.name}`,\n      description: product.description || `${formatKoreanWon(product.price)} · ${shop.name}에서 예약하세요`,\n      url: `${baseUrl}/${shop.slug}/reserve/${product.id}`,\n      siteName: '동네 가게',\n      images: product.image_url\n        ? [{ url: product.image_url, width: 1200, height: 630 }]\n        : shop.logo_url\n        ? [{ url: shop.logo_url, width: 1200, height: 630 }]\n        : [],\n      type: 'website',\n      locale: 'ko_KR',\n    },\n    twitter: {\n      card: 'summary_large_image',\n      title: `${product.title} - ${shop.name}`,\n      description: product.description || `${formatKoreanWon(product.price)} · ${shop.name}에서 예약하세요`,\n    },\n  }\n}\n\nfunction isExpired(deadline: string | null): boolean {\n  if (!deadline) return false\n  return new Date(deadline) < new Date()\n}\n\nfunction isSoldOut(product: { max_quantity: number | null; reserved_count: number }): boolean {\n  if (product.max_quantity === null) return false\n  return product.reserved_count >= product.max_quantity\n}\n\nexport default async function ReservePage({ params }: Props) {\n  const { 'shop-slug': slug, 'product-id': productId } = await params\n  const data = await getProductWithShop(slug, productId)\n\n  if (!data) notFound()\n\n  const { shop, product } = data\n  const expired = isExpired(product.deadline)\n  const soldOut = isSoldOut(product)\n\n  return (\n    <div className=\"min-h-dvh bg-stone-50\">\n      <header className=\"sticky top-0 z-20 flex h-14 items-center gap-3 border-b border-stone-200 bg-white/80 backdrop-blur-lg px-4\">\n        <Link\n          href={`/${slug}`}\n          className=\"flex h-9 w-9 items-center justify-center rounded-xl border border-stone-200 bg-white text-stone-500 hover:bg-stone-50 hover:text-stone-700 transition-colors min-h-[44px] min-w-[44px]\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n        </Link>\n        <div className=\"min-w-0\">\n          <p className=\"text-sm font-semibold text-stone-900 truncate\">{shop.name}</p>\n          <p className=\"text-xs text-stone-400 truncate\">{product.title}</p>\n        </div>\n      </header>\n\n      <main className=\"mx-auto max-w-md px-4 py-6\">\n        {expired ? (\n          <div className=\"rounded-2xl border border-stone-200 bg-white py-12 text-center shadow-sm\">\n            <div className=\"flex justify-center\">\n              <div className=\"flex h-14 w-14 items-center justify-center rounded-full bg-stone-100\">\n                <Clock className=\"h-7 w-7 text-stone-400\" />\n              </div>\n            </div>\n            <h2 className=\"mt-4 text-lg font-bold text-stone-900\">예약이 마감되었습니다</h2>\n            <p className=\"mt-1 text-sm text-stone-500\">이 상품의 예약 기한이 지났습니다</p>\n            <Link\n              href={`/${slug}`}\n              className=\"mt-5 inline-flex items-center gap-1.5 rounded-xl bg-stone-900 px-5 py-2.5 text-sm font-semibold text-white hover:bg-stone-800 transition-colors\"\n            >\n              가게로 돌아가기\n            </Link>\n          </div>\n        ) : soldOut ? (\n          <div className=\"rounded-2xl border border-stone-200 bg-white py-12 text-center shadow-sm\">\n            <h2 className=\"text-lg font-bold text-stone-900\">매진되었습니다</h2>\n            <p className=\"mt-1 text-sm text-stone-500\">이 상품은 예약이 모두 완료되었습니다</p>\n            <Link\n              href={`/${slug}`}\n              className=\"mt-5 inline-flex items-center gap-1.5 rounded-xl bg-stone-900 px-5 py-2.5 text-sm font-semibold text-white hover:bg-stone-800 transition-colors\"\n            >\n              가게로 돌아가기\n            </Link>\n          </div>\n        ) : (\n          <ReservationForm product={product} shopSlug={slug} />\n        )}\n      </main>\n    </div>\n  )\n}\n"
        }
    ]
}