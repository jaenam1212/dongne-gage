{
    "sourceFile": "app/admin/products/product-list.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1770982677443,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1770983321585,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -53,8 +53,9 @@\n   products: Product[]\n   currentFilter: string\n }) {\n   const router = useRouter()\n+  const [isSelectionMode, setIsSelectionMode] = useState(false)\n   const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set())\n   const [deleting, setDeleting] = useState(false)\n \n   const toggleSelect = (id: string) => {\n@@ -83,9 +84,9 @@\n       if (result?.error) {\n         toast.error(result.error)\n       } else {\n         toast.success('삭제되었습니다')\n-        setSelectedIds(new Set())\n+        exitSelectionMode()\n         router.refresh()\n       }\n     } catch {\n       toast.error('삭제에 실패했습니다')\n@@ -93,8 +94,13 @@\n       setDeleting(false)\n     }\n   }\n \n+  function exitSelectionMode() {\n+    setIsSelectionMode(false)\n+    setSelectedIds(new Set())\n+  }\n+\n   return (\n     <>\n       <Toaster\n         position=\"top-center\"\n@@ -105,19 +111,45 @@\n         <div className=\"flex flex-wrap items-center justify-between gap-3\">\n           <h1 className=\"text-xl font-bold text-stone-900\">상품 관리</h1>\n           <div className=\"flex items-center gap-2\">\n             {products.length > 0 && (\n-              <Button\n-                type=\"button\"\n-                variant=\"outline\"\n-                size=\"sm\"\n-                className=\"h-9 text-red-600 border-red-200 hover:bg-red-50 hover:text-red-700\"\n-                disabled={selectedIds.size === 0 || deleting}\n-                onClick={handleDeleteSelected}\n-              >\n-                <Trash2 className=\"h-4 w-4 mr-1.5\" />\n-                선택 삭제 {selectedIds.size > 0 ? `(${selectedIds.size})` : ''}\n-              </Button>\n+              <>\n+                {!isSelectionMode ? (\n+                  <Button\n+                    type=\"button\"\n+                    variant=\"outline\"\n+                    size=\"sm\"\n+                    className=\"h-9 text-red-600 border-red-200 hover:bg-red-50 hover:text-red-700\"\n+                    onClick={() => setIsSelectionMode(true)}\n+                  >\n+                    <Trash2 className=\"h-4 w-4 mr-1.5\" />\n+                    선택 삭제\n+                  </Button>\n+                ) : (\n+                  <>\n+                    <Button\n+                      type=\"button\"\n+                      variant=\"outline\"\n+                      size=\"sm\"\n+                      className=\"h-9\"\n+                      onClick={exitSelectionMode}\n+                    >\n+                      취소\n+                    </Button>\n+                    <Button\n+                      type=\"button\"\n+                      variant=\"outline\"\n+                      size=\"sm\"\n+                      className=\"h-9 text-red-600 border-red-200 hover:bg-red-50 hover:text-red-700\"\n+                      disabled={selectedIds.size === 0 || deleting}\n+                      onClick={handleDeleteSelected}\n+                    >\n+                      <Trash2 className=\"h-4 w-4 mr-1.5\" />\n+                      선택 삭제 {selectedIds.size > 0 ? `(${selectedIds.size})` : ''}\n+                    </Button>\n+                  </>\n+                )}\n+              </>\n             )}\n             <Button asChild className=\"h-9 bg-stone-900 text-white hover:bg-stone-800\">\n               <Link href=\"/admin/products/new\">\n                 <Plus className=\"h-4 w-4 mr-1.5\" />\n@@ -155,9 +187,9 @@\n             </Button>\n           </div>\n         ) : (\n           <div className=\"grid gap-3\">\n-            {products.length > 0 && (\n+            {isSelectionMode && products.length > 0 && (\n               <div className=\"flex items-center gap-2 rounded-lg border border-stone-200 bg-stone-50 px-3 py-2\">\n                 <Checkbox\n                   id=\"select-all\"\n                   checked={selectedIds.size === products.length}\n@@ -171,8 +203,9 @@\n             {products.map((product) => (\n               <ProductCard\n                 key={product.id}\n                 product={product}\n+                isSelectionMode={isSelectionMode}\n                 selected={selectedIds.has(product.id)}\n                 onSelectChange={() => toggleSelect(product.id)}\n                 onToggle={async (isActive) => {\n                   try {\n@@ -193,13 +226,15 @@\n }\n \n function ProductCard({\n   product,\n+  isSelectionMode,\n   selected,\n   onSelectChange,\n   onToggle,\n }: {\n   product: Product\n+  isSelectionMode: boolean\n   selected: boolean\n   onSelectChange: () => void\n   onToggle: (isActive: boolean) => void\n }) {\n@@ -216,16 +251,18 @@\n     <div className={`rounded-2xl border bg-white p-4 shadow-sm transition-colors ${\n       !product.is_active ? 'border-stone-200 opacity-60' : 'border-stone-200'\n     }`}>\n       <div className=\"flex gap-4\">\n-        <div className=\"flex shrink-0 items-start pt-0.5\">\n-          <Checkbox\n-            id={`select-${product.id}`}\n-            checked={selected}\n-            onCheckedChange={onSelectChange}\n-            aria-label={`${product.title} 선택`}\n-          />\n-        </div>\n+        {isSelectionMode && (\n+          <div className=\"flex shrink-0 items-start pt-0.5\">\n+            <Checkbox\n+              id={`select-${product.id}`}\n+              checked={selected}\n+              onCheckedChange={onSelectChange}\n+              aria-label={`${product.title} 선택`}\n+            />\n+          </div>\n+        )}\n         <div className=\"h-20 w-20 shrink-0 overflow-hidden rounded-xl bg-stone-100\">\n           {product.image_url ? (\n             <img\n               src={product.image_url}\n"
                }
            ],
            "date": 1770982677443,
            "name": "Commit-0",
            "content": "'use client'\n\nimport Link from 'next/link'\nimport { useRouter } from 'next/navigation'\nimport { useState } from 'react'\nimport { Plus, Pencil, Package, Clock, Trash2 } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { formatKoreanWon } from '@/lib/utils'\nimport { toggleProductActive, deleteProducts } from './actions'\nimport toast, { Toaster } from 'react-hot-toast'\nimport { Checkbox } from '@/components/ui/checkbox'\n\ninterface Product {\n  id: string\n  title: string\n  description: string | null\n  price: number\n  image_url: string | null\n  max_quantity: number | null\n  max_quantity_per_customer?: number | null\n  reserved_count: number\n  deadline: string | null\n  is_active: boolean\n  created_at: string\n}\n\nconst FILTERS = [\n  { key: 'all', label: '전체' },\n  { key: 'active', label: '활성' },\n  { key: 'inactive', label: '비활성' },\n] as const\n\nfunction isExpired(deadline: string | null): boolean {\n  if (!deadline) return false\n  return new Date(deadline) < new Date()\n}\n\nfunction getRemainingQuantity(product: Product): string {\n  if (product.max_quantity === null) return '무제한'\n  return `${product.max_quantity - product.reserved_count}개 남음`\n}\n\nfunction formatDeadline(deadline: string | null): string {\n  if (!deadline) return ''\n  const d = new Date(deadline)\n  return `${d.getMonth() + 1}/${d.getDate()} ${d.getHours().toString().padStart(2, '0')}:${d.getMinutes().toString().padStart(2, '0')}`\n}\n\nexport function ProductList({\n  products,\n  currentFilter,\n}: {\n  products: Product[]\n  currentFilter: string\n}) {\n  const router = useRouter()\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set())\n  const [deleting, setDeleting] = useState(false)\n\n  const toggleSelect = (id: string) => {\n    setSelectedIds((prev) => {\n      const next = new Set(prev)\n      if (next.has(id)) next.delete(id)\n      else next.add(id)\n      return next\n    })\n  }\n\n  const toggleSelectAll = () => {\n    if (selectedIds.size === products.length) setSelectedIds(new Set())\n    else setSelectedIds(new Set(products.map((p) => p.id)))\n  }\n\n  async function handleDeleteSelected() {\n    if (selectedIds.size === 0) {\n      toast.error('삭제할 상품을 선택해주세요')\n      return\n    }\n    if (!confirm(`선택한 ${selectedIds.size}개 상품을 삭제할까요?`)) return\n    setDeleting(true)\n    try {\n      const result = await deleteProducts(Array.from(selectedIds))\n      if (result?.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('삭제되었습니다')\n        setSelectedIds(new Set())\n        router.refresh()\n      }\n    } catch {\n      toast.error('삭제에 실패했습니다')\n    } finally {\n      setDeleting(false)\n    }\n  }\n\n  return (\n    <>\n      <Toaster\n        position=\"top-center\"\n        toastOptions={{ className: 'text-sm font-medium', duration: 3000 }}\n      />\n\n      <div className=\"space-y-5\">\n        <div className=\"flex flex-wrap items-center justify-between gap-3\">\n          <h1 className=\"text-xl font-bold text-stone-900\">상품 관리</h1>\n          <div className=\"flex items-center gap-2\">\n            {products.length > 0 && (\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"h-9 text-red-600 border-red-200 hover:bg-red-50 hover:text-red-700\"\n                disabled={selectedIds.size === 0 || deleting}\n                onClick={handleDeleteSelected}\n              >\n                <Trash2 className=\"h-4 w-4 mr-1.5\" />\n                선택 삭제 {selectedIds.size > 0 ? `(${selectedIds.size})` : ''}\n              </Button>\n            )}\n            <Button asChild className=\"h-9 bg-stone-900 text-white hover:bg-stone-800\">\n              <Link href=\"/admin/products/new\">\n                <Plus className=\"h-4 w-4 mr-1.5\" />\n                새 상품 등록\n              </Link>\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex gap-2\">\n          {FILTERS.map((f) => (\n            <Link\n              key={f.key}\n              href={f.key === 'all' ? '/admin/products' : `/admin/products?filter=${f.key}`}\n              className={`rounded-lg px-3.5 py-1.5 text-sm font-medium transition-colors ${\n                currentFilter === f.key\n                  ? 'bg-stone-900 text-white'\n                  : 'bg-white text-stone-500 border border-stone-200 hover:bg-stone-50 hover:text-stone-700'\n              }`}\n            >\n              {f.label}\n            </Link>\n          ))}\n        </div>\n\n        {products.length === 0 ? (\n          <div className=\"rounded-2xl border border-stone-200 bg-white py-16 text-center shadow-sm\">\n            <Package className=\"mx-auto h-10 w-10 text-stone-300\" />\n            <p className=\"mt-3 text-sm text-stone-400\">등록된 상품이 없습니다</p>\n            <Button asChild className=\"mt-4 h-9 bg-stone-900 text-white hover:bg-stone-800\">\n              <Link href=\"/admin/products/new\">\n                <Plus className=\"h-4 w-4 mr-1.5\" />\n                첫 상품 등록하기\n              </Link>\n            </Button>\n          </div>\n        ) : (\n          <div className=\"grid gap-3\">\n            {products.length > 0 && (\n              <div className=\"flex items-center gap-2 rounded-lg border border-stone-200 bg-stone-50 px-3 py-2\">\n                <Checkbox\n                  id=\"select-all\"\n                  checked={selectedIds.size === products.length}\n                  onCheckedChange={toggleSelectAll}\n                />\n                <label htmlFor=\"select-all\" className=\"text-sm text-stone-600 cursor-pointer\">\n                  전체 선택\n                </label>\n              </div>\n            )}\n            {products.map((product) => (\n              <ProductCard\n                key={product.id}\n                product={product}\n                selected={selectedIds.has(product.id)}\n                onSelectChange={() => toggleSelect(product.id)}\n                onToggle={async (isActive) => {\n                  try {\n                    await toggleProductActive(product.id, isActive)\n                    toast.success(isActive ? '상품이 활성화되었습니다' : '상품이 비활성화되었습니다')\n                    router.refresh()\n                  } catch {\n                    toast.error('상태 변경에 실패했습니다')\n                  }\n                }}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n    </>\n  )\n}\n\nfunction ProductCard({\n  product,\n  selected,\n  onSelectChange,\n  onToggle,\n}: {\n  product: Product\n  selected: boolean\n  onSelectChange: () => void\n  onToggle: (isActive: boolean) => void\n}) {\n  const [toggling, setToggling] = useState(false)\n  const expired = isExpired(product.deadline)\n\n  async function handleToggle() {\n    setToggling(true)\n    await onToggle(!product.is_active)\n    setToggling(false)\n  }\n\n  return (\n    <div className={`rounded-2xl border bg-white p-4 shadow-sm transition-colors ${\n      !product.is_active ? 'border-stone-200 opacity-60' : 'border-stone-200'\n    }`}>\n      <div className=\"flex gap-4\">\n        <div className=\"flex shrink-0 items-start pt-0.5\">\n          <Checkbox\n            id={`select-${product.id}`}\n            checked={selected}\n            onCheckedChange={onSelectChange}\n            aria-label={`${product.title} 선택`}\n          />\n        </div>\n        <div className=\"h-20 w-20 shrink-0 overflow-hidden rounded-xl bg-stone-100\">\n          {product.image_url ? (\n            <img\n              src={product.image_url}\n              alt={product.title}\n              className=\"h-full w-full object-cover\"\n            />\n          ) : (\n            <div className=\"flex h-full items-center justify-center\">\n              <Package className=\"h-6 w-6 text-stone-300\" />\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex flex-1 flex-col justify-between min-w-0\">\n          <div>\n            <div className=\"flex items-center gap-2\">\n              <h3 className=\"text-sm font-semibold text-stone-900 truncate\">\n                {product.title}\n              </h3>\n              {expired && (\n                <span className=\"shrink-0 inline-flex items-center gap-1 rounded-md bg-red-50 px-2 py-0.5 text-[11px] font-medium text-red-600 border border-red-100\">\n                  <Clock className=\"h-3 w-3\" />\n                  마감\n                </span>\n              )}\n              {!product.is_active && (\n                <span className=\"shrink-0 rounded-md bg-stone-100 px-2 py-0.5 text-[11px] font-medium text-stone-500\">\n                  비활성\n                </span>\n              )}\n            </div>\n            <p className=\"mt-0.5 text-base font-bold text-stone-800\">\n              {formatKoreanWon(product.price)}\n            </p>\n          </div>\n\n          <div className=\"flex items-center gap-3 text-xs text-stone-400\">\n            <span>{getRemainingQuantity(product)}</span>\n            {product.deadline && (\n              <>\n                <span>·</span>\n                <span>마감 {formatDeadline(product.deadline)}</span>\n              </>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex shrink-0 flex-col items-end gap-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"h-8 text-xs\"\n            asChild\n          >\n            <Link href={`/admin/products/${product.id}/edit`}>\n              <Pencil className=\"h-3 w-3 mr-1\" />\n              수정\n            </Link>\n          </Button>\n          <button\n            type=\"button\"\n            onClick={handleToggle}\n            disabled={toggling}\n            className=\"relative h-6 w-11 rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stone-400 focus-visible:ring-offset-2 disabled:opacity-50\"\n            style={{\n              backgroundColor: product.is_active ? '#1c1917' : '#d6d3d1',\n            }}\n            aria-label={product.is_active ? '비활성화' : '활성화'}\n          >\n            <span\n              className=\"block h-5 w-5 rounded-full bg-white shadow-sm transition-transform\"\n              style={{\n                transform: product.is_active ? 'translateX(22px)' : 'translateX(2px)',\n              }}\n            />\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n"
        }
    ]
}